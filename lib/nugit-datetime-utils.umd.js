!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t["nugit-datetime-utils"]=e()}(this,function(){"use strict";var v=function(t){return t instanceof Date},m=36e5,g=6e4,h=/[T ]/,y=/:/,D=/^(\d{2})$/,p=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],M=/^(\d{4})/,Y=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],b=/^-(\d{2})$/,T=/^-?(\d{3})$/,w=/^-?(\d{2})-?(\d{2})$/,S=/^-?W(\d{2})$/,F=/^-?W(\d{2})-?(\d{1})$/,x=/^(\d{2}([.,]\d*)?)$/,H=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,$=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,N=/([Z+-].*)$/,_=/^(Z)$/,I=/^([+-])(\d{2})$/,k=/^([+-])(\d{2}):?(\d{2})$/;function O(t,e,r){e=e||0,r=r||0;var n=new Date(0);n.setUTCFullYear(t,0,4);var a=7*e+r+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+a),n}var s=function(t,e){if(v(t))return new Date(t.getTime());if("string"!=typeof t)return new Date(t);var r=(e||{}).additionalDigits;r=null==r?2:Number(r);var n=function(t){var e,r={},n=t.split(h);if(e=y.test(n[0])?(r.date=null,n[0]):(r.date=n[0],n[1])){var a=N.exec(e);a?(r.time=e.replace(a[1],""),r.timezone=a[1]):r.time=e}return r}(t),a=function(t,e){var r,n=p[e],a=Y[e];if(r=M.exec(t)||a.exec(t)){var u=r[1];return{year:parseInt(u,10),restDateString:t.slice(u.length)}}if(r=D.exec(t)||n.exec(t)){var o=r[1];return{year:100*parseInt(o,10),restDateString:t.slice(o.length)}}return{year:null}}(n.date,r),u=a.year,o=function(t,e){if(null===e)return null;var r,n,a,u;if(0===t.length)return(n=new Date(0)).setUTCFullYear(e),n;if(r=b.exec(t))return n=new Date(0),a=parseInt(r[1],10)-1,n.setUTCFullYear(e,a),n;if(r=T.exec(t)){n=new Date(0);var o=parseInt(r[1],10);return n.setUTCFullYear(e,0,o),n}if(r=w.exec(t)){n=new Date(0),a=parseInt(r[1],10)-1;var i=parseInt(r[2],10);return n.setUTCFullYear(e,a,i),n}if(r=S.exec(t))return u=parseInt(r[1],10)-1,O(e,u);if(r=F.exec(t)){u=parseInt(r[1],10)-1;var s=parseInt(r[2],10)-1;return O(e,u,s)}return null}(a.restDateString,u);if(o){var i,s=o.getTime(),c=0;return n.time&&(c=function(t){var e,r,n;if(e=x.exec(t))return(r=parseFloat(e[1].replace(",",".")))%24*m;if(e=H.exec(t))return r=parseInt(e[1],10),n=parseFloat(e[2].replace(",",".")),r%24*m+n*g;if(e=$.exec(t)){r=parseInt(e[1],10),n=parseInt(e[2],10);var a=parseFloat(e[3].replace(",","."));return r%24*m+n*g+1e3*a}return null}(n.time)),i=n.timezone?(f=n.timezone,(l=_.exec(f))?0:(l=I.exec(f))?(d=60*parseInt(l[2],10),"+"===l[1]?-d:d):(l=k.exec(f))?(d=60*parseInt(l[2],10)+parseInt(l[3],10),"+"===l[1]?-d:d):0):(i=new Date(s+c).getTimezoneOffset(),new Date(s+c+i*g).getTimezoneOffset()),new Date(s+c+i*g)}var f,l,d;return new Date(t)};var P=function(t,e){var r=s(t),n=Number(e);return r.setDate(r.getDate()+n),r};var c=function(t){var e=s(t),r=e.getFullYear(),n=e.getMonth(),a=new Date(0);return a.setFullYear(r,n+1,0),a.setHours(0,0,0,0),a.getDate()};var n=function(t,e){var r=s(t),n=Number(e),a=r.getMonth()+n,u=new Date(0);u.setFullYear(r.getFullYear(),a,1),u.setHours(0,0,0,0);var o=c(u);return r.setMonth(a,Math.min(o,r.getDate())),r};var W=function(t){var e=s(t),r=e.getFullYear();return e.setFullYear(r+1,0,0),e.setHours(23,59,59,999),e};var o=function(t){var e=s(t);return e.setHours(0,0,0,0),e};var i=function(t,e){var r=o(t),n=o(e),a=r.getTime()-6e4*r.getTimezoneOffset(),u=n.getTime()-6e4*n.getTimezoneOffset();return Math.round((a-u)/864e5)};var f=function(t,e){var r=s(t).getTime(),n=s(e).getTime();return r<n?-1:n<r?1:0};var z=function(t,e){var r=s(t),n=s(e),a=f(r,n),u=Math.abs(i(r,n));return r.setDate(r.getDate()-a*u),a*(u-(f(r,n)===-a))};var G=function(t){return s(t).getDate()};var E=function(t){return s(t).getMonth()};var A=function(t){return s(t).getFullYear()};var a=function(t){var e=s(t),r=e.getFullYear();return e.setFullYear(r+1,0,0),e.setHours(0,0,0,0),e};var u=function(t,e){var r=s(t),n=Number(e);return r.setDate(n),r};var l=function(t,e,r){var n=r&&Number(r.weekStartsOn)||0,a=s(t),u=Number(e),o=a.getDay();return P(a,((u%7+7)%7<n?7:0)+u-o)};var C=function(t,e){var r=s(t),n=Number(e);return r.setMonth(0),r.setDate(n),r};var d=function(t,e){var r=s(t),n=Number(e),a=r.getFullYear(),u=r.getDate(),o=new Date(0);o.setFullYear(a,n,15),o.setHours(0,0,0,0);var i=c(o);return r.setMonth(n,Math.min(u,i)),r};var U=function(t,e){var r=Number(e);return P(t,-r)};var X=function(t,e){var r=Number(e);return n(t,-r)};var Z=function(t,e){var r=Number(e);return P(t,7*r)};var q=function(t,e){var r=Number(e);return Z(t,-r)};var J=function(t,e){var r=Number(e);return n(t,12*r)};var R=function(t,e){var r=Number(e);return J(t,-r)};function Q(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=[],n=!0,a=!1,u=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,u=t}finally{try{n||null==i.return||i.return()}finally{if(a)throw u}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var r=function(t){var e=s(t),r=new Date(0);return r.setFullYear(e.getFullYear(),0,1),r.setHours(0,0,0,0),r};var e=function(t){var e=s(t);return i(e,r(e))+1};var j=function(t,e){var r=e&&Number(e.weekStartsOn)||0,n=s(t),a=n.getDay(),u=(a<r?7:0)+a-r;return n.setDate(n.getDate()-u),n.setHours(0,0,0,0),n};var B=function(t){return j(t,{weekStartsOn:1})};var K=function(t){var e=s(t),r=e.getFullYear(),n=new Date(0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);var a=B(n),u=new Date(0);u.setFullYear(r,0,4),u.setHours(0,0,0,0);var o=B(u);return e.getTime()>=a.getTime()?r+1:e.getTime()>=o.getTime()?r:r-1};var L=function(t){var e=K(t),r=new Date(0);return r.setFullYear(e,0,4),r.setHours(0,0,0,0),B(r)};var V=function(t){var e=s(t),r=B(e).getTime()-L(e).getTime();return Math.round(r/6048e5)+1};var tt=function(t){if(v(t))return!isNaN(t);throw new TypeError(toString.call(t)+" is not an instance of Date")};var et=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];var rt=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);var n=et.concat(e).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+n.join("|")+"|.)","g")};var t=function(){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Su","Mo","Tu","We","Th","Fr","Sa"],a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["AM","PM"],i=["am","pm"],s=["a.m.","p.m."],t={MMM:function(t){return e[t.getMonth()]},MMMM:function(t){return r[t.getMonth()]},dd:function(t){return n[t.getDay()]},ddd:function(t){return a[t.getDay()]},dddd:function(t){return u[t.getDay()]},A:function(t){return 1<=t.getHours()/12?o[1]:o[0]},a:function(t){return 1<=t.getHours()/12?i[1]:i[0]},aa:function(t){return 1<=t.getHours()/12?s[1]:s[0]}};return["M","D","DDD","d","Q","W"].forEach(function(r){t[r+"o"]=function(t,e){return function(t){var e=t%100;if(20<e||e<10)switch(e%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"}(e[r](t))}}),{formatters:t,formattingTokensRegExp:rt(t)}},nt={distanceInWords:function(){var a={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(t,e,r){var n;return r=r||{},n="string"==typeof a[t]?a[t]:1===e?a[t].one:a[t].other.replace("{{count}}",e),r.addSuffix?0<r.comparison?"in "+n:n+" ago":n}}}(),format:t()};var at={M:function(t){return t.getMonth()+1},MM:function(t){return ot(t.getMonth()+1,2)},Q:function(t){return Math.ceil((t.getMonth()+1)/3)},D:function(t){return t.getDate()},DD:function(t){return ot(t.getDate(),2)},DDD:function(t){return e(t)},DDDD:function(t){return ot(e(t),3)},d:function(t){return t.getDay()},E:function(t){return t.getDay()||7},W:function(t){return V(t)},WW:function(t){return ot(V(t),2)},YY:function(t){return ot(t.getFullYear(),4).substr(2)},YYYY:function(t){return ot(t.getFullYear(),4)},GG:function(t){return String(K(t)).substr(2)},GGGG:function(t){return K(t)},H:function(t){return t.getHours()},HH:function(t){return ot(t.getHours(),2)},h:function(t){var e=t.getHours();return 0===e?12:12<e?e%12:e},hh:function(t){return ot(at.h(t),2)},m:function(t){return t.getMinutes()},mm:function(t){return ot(t.getMinutes(),2)},s:function(t){return t.getSeconds()},ss:function(t){return ot(t.getSeconds(),2)},S:function(t){return Math.floor(t.getMilliseconds()/100)},SS:function(t){return ot(Math.floor(t.getMilliseconds()/10),2)},SSS:function(t){return ot(t.getMilliseconds(),3)},Z:function(t){return ut(t.getTimezoneOffset(),":")},ZZ:function(t){return ut(t.getTimezoneOffset())},X:function(t){return Math.floor(t.getTime()/1e3)},x:function(t){return t.getTime()}};function ut(t,e){e=e||"";var r=0<t?"-":"+",n=Math.abs(t),a=n%60;return r+ot(Math.floor(n/60),2)+e+ot(a,2)}function ot(t,e){for(var r=Math.abs(t).toString();r.length<e;)r="0"+r;return r}var it=function(t,e,r){var n=e?String(e):"YYYY-MM-DDTHH:mm:ss.SSSZ",a=(r||{}).locale,u=nt.format.formatters,o=nt.format.formattingTokensRegExp;a&&a.format&&a.format.formatters&&(u=a.format.formatters,a.format.formattingTokensRegExp&&(o=a.format.formattingTokensRegExp));var i=s(t);return tt(i)?function(t,e,r){var n,a,u,o=t.match(r),i=o.length;for(n=0;n<i;n++)a=e[o[n]]||at[o[n]],o[n]=a||((u=o[n]).match(/\[[\s\S]/)?u.replace(/^\[|]$/g,""):u.replace(/\\/g,""));return function(t){for(var e="",r=0;r<i;r++)o[r]instanceof Function?e+=o[r](t,at):e+=o[r];return e}}(n,u,o)(i):"Invalid Date"},st=function(t){return it(t,"YYYY-MM-DD")},ct=function(t){return"year"===t?R:"quarter"===t?function(t,e){return X(t,3*e)}:"month"===t?X:"week"===t?q:U},ft=function(t){return"number"!=typeof t?3600*(e=Q(t.split(":"),2),r=e[0],n=e[1],a="+"===r[0],u=parseInt(r.slice(1),10)+parseInt(n,10)/60,a?u:-u)*1e3:15<Math.abs(t)?1e3*t:3600*t*1e3;var e,r,n,a,u},lt=function(t,e){if(!t)return e;var r,n=new Date(e),a=(r=n,ft(t)+60*r.getTimezoneOffset()*1e3);return new Date(n.getTime()+a).toString()};function dt(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Date();return"year"===e?{start:st(C(R(r,t),1)),end:st(u(d(R(r,1),11),31))}:"quarter"===e?{start:st(u(X(r,3*t+E(r)%3),1)),end:st(u(n(X(r,3*t),3-E(r)%3),0))}:"month"===e?{start:st(u(X(r,t),1)),end:st(u(r,0))}:"week"===e?{start:st(l(q(r,t),1)),end:st(l(q(r,1),7))}:{start:st(U(r,t)),end:st(U(r,1))}}function vt(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date();if("year"===t)return{start:st(C(e,1)),end:st(a(e))};if("quarter"===t)return{start:st(u(X(e,E(e)%3),1)),end:st(u(n(e,3-E(e)%3),0))};if("month"===t)return{start:st(u(e,1)),end:st(e)};if("week"===t)return{start:st(l(e,1)),end:st(l(e,7))};var r=st(e);return{start:r,end:r}}function mt(t){if("string"!=typeof t)return t;var e=t.match(/^last(\d+)(day|week|month|quarter|year)s?$/);return e?{type:"last",num:Number(e[1]),unit:e[2]}:(e=t.match(/^last_(day|week|month|quarter|year)$/))?{type:"last",num:1,unit:e[1]}:(e=t.match(/^last_(\d+)_(day|week|month|quarter|year)s?(_including_current)?$/))?{type:"last",num:Number(e[1]),unit:e[2],newFormat:!0,including_current:"_including_current"===e[3],includeingParam:"day"===e[2]?"today":"this ".concat(e[2])}:(e=t.match(/^this_(day|week|month|quarter|year)$/))?{type:"this",unit:e[1]}:(e=t.match(/^(\d{4}-\d{2}-\d{2})_to_yesterday$/))?{type:"till_tomorrow",start:e[1]}:"last"===t?{type:"last",num:void 0,unit:void 0}:null}function gt(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date(),r=2<arguments.length?arguments[2]:void 0;if("string"!=typeof t)return t;var n=lt(r,e),a=mt(t);return a&&"last"===a.type?a.including_current?1===a.num?vt(a.unit,n):{start:dt(a.num-1,a.unit,n).start,end:vt(a.unit,n).end}:dt(a.num,a.unit,n):a&&"this"===a.type?vt(a.unit,n):a&&"till_tomorrow"===a.type?{start:a.start,end:st(U(n,1))}:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date();if("today"===t){var r=st(e);return{start:r,end:r}}if("yesterday"===t){var n=st(U(e,1));return{start:n,end:n}}if("year_to_date"===t)return{start:st(C(e,1)),end:st(e)};if("all_time"===t)return{start:st(R(e,3)),end:st(e)};throw new Error("Unrecognized date range: ".concat(t))}(t,n)}function ht(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date(),r={period:{}},n=gt(t,e),a=mt(t);if(a&&"this"===a.type){var u=ct(a.unit);return{label:"Previous ".concat(a.unit),period:{start:st(u(n.start,1)),end:st(U(n.start,1))}}}if(a&&"last"===a.type){var o=ct(a.unit);return{label:"Previous ".concat(a.num," ").concat(a.unit),period:{start:st(o(n.start,a.num)),end:st(U(n.start,1))}}}if("year_to_date"===t)return{label:"Previous Year",period:{start:st(C(R(e,1),1)),end:st(W(R(e,1)))}};r.label="today"===t||"yesterday"===t?"Previous Day":"Previous Period";var i=n.start,s=n.end,c=z(s,i)+1,f=U(i,c),l=U(i,1),d=P(s,1);if(1===G(i)&&1===G(d)){var v=12*(A(d)-A(i))+E(d)-E(i);f=X(n.start,v)}return 1===E(i)&&1===G(i)&&1===E(d)&&1===G(d)&&(f=R(i,A(d)-A(i))),r.period={start:st(f),end:st(l)},r}return{retrievePeriod:gt,retrievePeriodParams:mt,calculateAutoCompare:ht,retrieveComparePeriod:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"auto";if("auto"===e)return ht(t).period;if("12_months_ago"!==e)return e;var r=gt(t);return{start:st(R(r.start,1)),end:st(R(r.end,1))}}}});
