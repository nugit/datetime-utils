!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["nugit-datetime-utils"]=t()}(this,function(){"use strict";function v(e){var t=new Date(e.getTime()),r=t.getTimezoneOffset();return t.setSeconds(0,0),6e4*r+t.getTime()%6e4}var m=function(e){return e instanceof Date},h=36e5,y=6e4,D=/[T ]/,p=/:/,M=/^(\d{2})$/,w=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],Y=/^(\d{4})/,b=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],T=/^-(\d{2})$/,_=/^-?(\d{3})$/,S=/^-?(\d{2})-?(\d{2})$/,F=/^-?W(\d{2})$/,x=/^-?W(\d{2})-?(\d{1})$/,H=/^(\d{2}([.,]\d*)?)$/,$=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,P=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,I=/([Z+-].*)$/,N=/^(Z)$/,k=/^([+-])(\d{2})$/,C=/^([+-])(\d{2}):?(\d{2})$/;function O(e,t,r){t=t||0,r=r||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var a=7*t+r+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+a),n}var c=function(e,t){if(m(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var r=(t||{}).additionalDigits;r=null==r?2:Number(r);var n=function(e){var t,r={},n=e.split(D);t=p.test(n[0])?(r.date=null,n[0]):(r.date=n[0],n[1]);if(t){var a=I.exec(t);a?(r.time=t.replace(a[1],""),r.timezone=a[1]):r.time=t}return r}(e),a=function(e,t){var r,n=w[t],a=b[t];if(r=Y.exec(e)||a.exec(e)){var u=r[1];return{year:parseInt(u,10),restDateString:e.slice(u.length)}}if(r=M.exec(e)||n.exec(e)){var o=r[1];return{year:100*parseInt(o,10),restDateString:e.slice(o.length)}}return{year:null}}(n.date,r),u=a.year,o=function(e,t){if(null===t)return null;var r,n,a,u;if(0===e.length)return(n=new Date(0)).setUTCFullYear(t),n;if(r=T.exec(e))return n=new Date(0),a=parseInt(r[1],10)-1,n.setUTCFullYear(t,a),n;if(r=_.exec(e)){n=new Date(0);var o=parseInt(r[1],10);return n.setUTCFullYear(t,0,o),n}if(r=S.exec(e)){n=new Date(0),a=parseInt(r[1],10)-1;var i=parseInt(r[2],10);return n.setUTCFullYear(t,a,i),n}if(r=F.exec(e))return u=parseInt(r[1],10)-1,O(t,u);if(r=x.exec(e)){u=parseInt(r[1],10)-1;var c=parseInt(r[2],10)-1;return O(t,u,c)}return null}(a.restDateString,u);if(o){var i,c=o.getTime(),s=0;if(n.time&&(s=function(e){var t,r,n;if(t=H.exec(e))return(r=parseFloat(t[1].replace(",",".")))%24*h;if(t=$.exec(e))return r=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")),r%24*h+n*y;if(t=P.exec(e)){r=parseInt(t[1],10),n=parseInt(t[2],10);var a=parseFloat(t[3].replace(",","."));return r%24*h+n*y+1e3*a}return null}(n.time)),n.timezone)i=function(e){var t,r;if(t=N.exec(e))return 0;if(t=k.exec(e))return r=60*parseInt(t[2],10),"+"===t[1]?-r:r;if(t=C.exec(e))return r=60*parseInt(t[2],10)+parseInt(t[3],10),"+"===t[1]?-r:r;return 0}(n.timezone)*y;else{var f=c+s,l=new Date(f);i=v(l);var d=new Date(f);d.setDate(l.getDate()+1);var g=v(d)-v(l);0<g&&(i+=g)}return new Date(c+s+i)}return new Date(e)};var d=function(e){return c(e).getDate()};var g=function(e){var t=c(e),r=t.getFullYear(),n=t.getMonth(),a=new Date(0);return a.setFullYear(r,n+1,0),a.setHours(0,0,0,0),a.getDate()};var t=function(e){var t=c(e).getFullYear();return t%400==0||t%4==0&&t%100!=0};var A=function(e){return t(e)?366:365};var r=function(e){var t=c(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r};var o=function(e){var t=c(e);return t.setHours(0,0,0,0),t};var i=function(e,t){var r=o(e),n=o(t),a=r.getTime()-6e4*r.getTimezoneOffset(),u=n.getTime()-6e4*n.getTimezoneOffset();return Math.round((a-u)/864e5)};var W=function(e){var t=c(e);return i(t,r(t))+1};var z=function(e){return 1===c(e).getDay()};var E=function(e,t){var r=o(e),n=o(t);return r.getTime()===n.getTime()};var G=function(e){return 0===c(e).getDay()};var n=function(e,t){var r=c(e),n=Number(t);return r.setDate(r.getDate()+n),r};var q=function(e,t){var r=Number(t);return n(e,-r)};var a=function(e,t){var r=c(e),n=Number(t),a=r.getMonth()+n,u=new Date(0);u.setFullYear(r.getFullYear(),a,1),u.setHours(0,0,0,0);var o=g(u);return r.setMonth(a,Math.min(o,r.getDate())),r};var u=function(e,t){var r=Number(t);return a(e,12*r)};var s=function(e,t){var r=Number(t);return u(e,-r)};function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,u=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,u=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw u}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var l=function(e,t){var r=c(e).getTime(),n=c(t).getTime();return r<n?-1:n<r?1:0};var U=function(e,t){var r=c(e),n=c(t),a=l(r,n),u=Math.abs(i(r,n));return r.setDate(r.getDate()-a*u),a*(u-(l(r,n)===-a))};var X=function(e,t){var r=c(e),n=c(t);return 12*(r.getFullYear()-n.getFullYear())+(r.getMonth()-n.getMonth())};var Z=function(e,t){var r=c(e),n=c(t),a=l(r,n),u=Math.abs(X(r,n));return r.setMonth(r.getMonth()-a*u),a*(u-(l(r,n)===-a))};function R(e,t){var r=Z(e,t)/3;return 0<r?Math.floor(r):Math.ceil(r)}function J(e,t){var r=U(e,t)/7;return 0<r?Math.floor(r):Math.ceil(r)}var L=function(e,t){var r=c(e),n=c(t);return r.getFullYear()-n.getFullYear()};function j(e,t){var r=c(e),n=c(t),a=l(r,n),u=Math.abs(L(r,n));return r.setFullYear(r.getFullYear()-a*u),a*(u-(l(r,n)===-a))}var Q=function(e,t){var r=t&&Number(t.weekStartsOn)||0,n=c(e),a=n.getDay(),u=6+(a<r?-7:0)-(a-r);return n.setDate(n.getDate()+u),n.setHours(23,59,59,999),n};function B(e){return Q(e,{weekStartsOn:1})}function K(e){var t=c(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function V(e){var t=c(e),r=t.getMonth(),n=r-r%3+3;return t.setMonth(n,0),t.setHours(23,59,59,999),t}function ee(e){var t=c(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(23,59,59,999),t}var te=function(e,t){var r=t&&Number(t.weekStartsOn)||0,n=c(e),a=n.getDay(),u=(a<r?7:0)+a-r;return n.setDate(n.getDate()-u),n.setHours(0,0,0,0),n};var re=function(e){return te(e,{weekStartsOn:1})};var ne=function(e){var t=c(e),r=t.getFullYear(),n=new Date(0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);var a=re(n),u=new Date(0);u.setFullYear(r,0,4),u.setHours(0,0,0,0);var o=re(u);return t.getTime()>=a.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1};var ae=function(e){var t=ne(e),r=new Date(0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),re(r)};var ue=function(e){var t=c(e),r=re(t).getTime()-ae(t).getTime();return Math.round(r/6048e5)+1};var oe=function(e){if(m(e))return!isNaN(e);throw new TypeError(toString.call(e)+" is not an instance of Date")};var ie=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];var ce=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);var n=ie.concat(t).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+n.join("|")+"|.)","g")};var e=function(){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Su","Mo","Tu","We","Th","Fr","Sa"],a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["AM","PM"],i=["am","pm"],c=["a.m.","p.m."],e={MMM:function(e){return t[e.getMonth()]},MMMM:function(e){return r[e.getMonth()]},dd:function(e){return n[e.getDay()]},ddd:function(e){return a[e.getDay()]},dddd:function(e){return u[e.getDay()]},A:function(e){return 1<=e.getHours()/12?o[1]:o[0]},a:function(e){return 1<=e.getHours()/12?i[1]:i[0]},aa:function(e){return 1<=e.getHours()/12?c[1]:c[0]}};return["M","D","DDD","d","Q","W"].forEach(function(r){e[r+"o"]=function(e,t){return function(e){var t=e%100;if(20<t||t<10)switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"}(t[r](e))}}),{formatters:e,formattingTokensRegExp:ce(e)}},se={distanceInWords:function(){var a={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(e,t,r){var n;return r=r||{},n="string"==typeof a[e]?a[e]:1===t?a[e].one:a[e].other.replace("{{count}}",t),r.addSuffix?0<r.comparison?"in "+n:n+" ago":n}}}(),format:e()};var fe={M:function(e){return e.getMonth()+1},MM:function(e){return ge(e.getMonth()+1,2)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},D:function(e){return e.getDate()},DD:function(e){return ge(e.getDate(),2)},DDD:function(e){return W(e)},DDDD:function(e){return ge(W(e),3)},d:function(e){return e.getDay()},E:function(e){return e.getDay()||7},W:function(e){return ue(e)},WW:function(e){return ge(ue(e),2)},YY:function(e){return ge(e.getFullYear(),4).substr(2)},YYYY:function(e){return ge(e.getFullYear(),4)},GG:function(e){return String(ne(e)).substr(2)},GGGG:function(e){return ne(e)},H:function(e){return e.getHours()},HH:function(e){return ge(e.getHours(),2)},h:function(e){var t=e.getHours();return 0===t?12:12<t?t%12:t},hh:function(e){return ge(fe.h(e),2)},m:function(e){return e.getMinutes()},mm:function(e){return ge(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return ge(e.getSeconds(),2)},S:function(e){return Math.floor(e.getMilliseconds()/100)},SS:function(e){return ge(Math.floor(e.getMilliseconds()/10),2)},SSS:function(e){return ge(e.getMilliseconds(),3)},Z:function(e){return de(e.getTimezoneOffset(),":")},ZZ:function(e){return de(e.getTimezoneOffset())},X:function(e){return Math.floor(e.getTime()/1e3)},x:function(e){return e.getTime()}};function le(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|]$/g,""):e.replace(/\\/g,"")}function de(e,t){t=t||"";var r=0<e?"-":"+",n=Math.abs(e),a=n%60;return r+ge(Math.floor(n/60),2)+t+ge(a,2)}function ge(e,t){for(var r=Math.abs(e).toString();r.length<t;)r="0"+r;return r}var ve=function(e,t,r){var n=t?String(t):"YYYY-MM-DDTHH:mm:ss.SSSZ",a=(r||{}).locale,u=se.format.formatters,o=se.format.formattingTokensRegExp;a&&a.format&&a.format.formatters&&(u=a.format.formatters,a.format.formattingTokensRegExp&&(o=a.format.formattingTokensRegExp));var i=c(e);return oe(i)?function(e,t,r){var n,a,u=e.match(r),o=u.length;for(n=0;n<o;n++)a=t[u[n]]||fe[u[n]],u[n]=a||le(u[n]);return function(e){for(var t="",r=0;r<o;r++)u[r]instanceof Function?t+=u[r](e,fe):t+=u[r];return t}}(n,u,o)(i):"Invalid Date"};function me(e){var t=c(e);return t.setDate(1),t.setHours(0,0,0,0),t}function he(e){var t=c(e),r=t.getMonth(),n=r-r%3;return t.setMonth(n,1),t.setHours(0,0,0,0),t}function ye(e,t){var r=Number(t);return a(e,-r)}var De=function(e,t){var r=Number(t);return a(e,3*r)};function pe(e,t){var r=Number(t);return De(e,-r)}var Me=function(e,t){var r=Number(t);return n(e,7*r)};function we(e,t){var r=Number(t);return Me(e,-r)}function Ye(e){return ve(e,"YYYY-MM-DD")}function be(e){return"year"===e?s:"quarter"===e?pe:"month"===e?ye:"week"===e?we:q}function Te(e){return"year"===e?r:"quarter"===e?he:"month"===e?me:"week"===e?re:function(e){return e}}function _e(e){return"year"===e?ee:"quarter"===e?V:"month"===e?K:"week"===e?B:function(e){return e}}function Se(e){return"number"!=typeof e?3600*function(e){var t=f(e.split(":"),2),r=t[0],n=t[1],a="+"===r[0],u=parseInt(r.slice(1),10)+parseInt(n,10)/60;return a?u:-u}(e)*1e3:15<Math.abs(e)?1e3*e:3600*e*1e3}function Fe(e,t){if(!e)return t;var r=t instanceof Date?t:new Date(t),n=function(e){return Se(e)+60*(new Date).getTimezoneOffset()*1e3}(e);return new Date(r.getTime()+n)}function xe(e,t){return{start:Ye(e),end:Ye(t)}}function He(e,t,r){var n=1<arguments.length&&void 0!==t?t:new Date,a=2<arguments.length&&void 0!==r?r:1,u=q(n,1),o=Te(e),i=be(e);return xe(o(i(u,a-1)),Ye(u))}function $e(e,t){var r=1<arguments.length&&void 0!==t?t:new Date,n=q(r,1);return xe(e,n)}function Pe(e){var t=e.match(/^last_(day|week|month|quarter|year)(_including_current)?$/);if(t)return{type:"last",num:1,unit:t[1],including_current:"_including_current"===t[2],includingParam:"this"};if(t=e.match(/^last_(\d+)_(day|week|month|quarter|year)s?(_including_current)?$/))return{type:"last",num:Number(t[1]),unit:t[2],including_current:"_including_current"===t[3],includingParam:"day"===t[2]?"today":"this ".concat(t[2])};if(t=e.match(/^this_(day|week|month|quarter|year)$/))return{type:"this",unit:t[1]};if(t=e.match(/^(\d{4}-\d{2}-\d{2})_to_yesterday$/))return{type:"till_yesterday",start:t[1]};if(t=e.match(/^(\d{4}-\d{2}-\d{2})_to_(\d{4}-\d{2}-\d{2})$/))return{type:"custom",start:t[1],end:t[2]};switch(e){case"yesterday":return{type:"yesterday"};case"all_time":return{type:"all_time"};default:throw new Error("Unrecognized date range: ".concat(e))}}function Ie(e,t,r){var n=1<arguments.length&&void 0!==t?t:new Date,a=2<arguments.length&&void 0!==r?r:0,u=Fe(a,n),o=Pe(e);switch(o.type){case"last":var i=o.unit,c=o.num;return o.including_current?He(i,u,c):function(e,t,r){var n=2<arguments.length&&void 0!==r?r:new Date,a=Te(t),u=_e(t),o=be(t);return xe(a(o(n,e)),u(o(n,1)))}(c,i,u);case"this":return He(o.unit,u);case"till_yesterday":return $e(Fe(a,o.start),u);case"yesterday":return He("day",u);case"all_time":return $e(new Date("2015-01-01"),u);case"custom":return xe(Fe(a,o.start),Fe(a,o.end));default:throw new Error("Unrecognized date range: ".concat(e))}}function Ne(e,t){var r=1<arguments.length&&void 0!==t?t:new Date,n=Ie(e,r),a=n.start,u=n.end,o=Pe(e);switch(o.type){case"last":var i=be(o.unit);return{label:"Previous ".concat(o.num," ").concat(o.unit),range:xe(i(a,o.num),q(a,1))};case"this":var c=be(o.unit);return{label:"Previous ".concat(o.unit),range:xe(c(a,1),q(a,1))};case"yesterday":return{label:"Previous Day",range:xe(q(a,1),q(a,1))};default:var s=function(e,t){if(1===W(e)&&W(t)===A(t))return"year";var r=Te("quarter"),n=_e("quarter");return E(r(e),e)&&E(n(t),t)?"quarter":1===d(e)&&d(t)===g(t)?"month":z(e)&&G(t)?"week":"day"}(a,u),f=be(s)(a,function(e){return"year"===e?j:"quarter"===e?R:"month"===e?Z:"week"===e?J:U}(s)(u,a)+1),l=q(a,1);return{label:"Previous Period",range:xe(f,l)}}}function ke(e,t){var r=1<arguments.length&&void 0!==t?t:"auto";switch(r){case"auto":return Ne(e).range;case"12_months_ago":var n=Ie(e),a=n.start,u=n.end;return xe(s(a,1),s(u,1));default:return Ie(r)}}function Ce(e,t){return"".concat(Ye(e),"_to_").concat(Ye(t))}function Oe(e){if("string"!=typeof e)return Ce(e.start,e.end);var t=e.match(/^last(\d+)(day|week|month|quarter|year)s?$/);if(t)return"last_".concat(t[1],"_").concat(t[2]);var r=e.match(/^(last_(\d+)_days?)_including_current$/);if(r)return r[1];switch(e){case"today":return"yesterday";case"year_to_date":return"this_year";default:return e}}function Ae(e){var t=0<arguments.length&&void 0!==e?e:"auto";switch(t){case"auto":case"12_months_ago":return t;default:return Oe(t)}}function We(a){return function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return a.apply(void 0,[Oe(e)].concat(r))}}function ze(e){return"custom"===Pe(e).type?Ie(e):e}var Ee=We(Ie),Ge=We(Pe);return{getRange:Ie,getPeriodParams:Pe,getCompareRange:ke,getAutoCompareRangeAndLabel:Ne,getTillYesterdayPeriod:function(e){return"".concat(Ye(e),"_to_yesterday")},getCustomPeriod:Ce,getLastPeriod:function(e,t,r){var n="".concat(t).concat(r?"_including_current":"");return 1===e?"last_".concat(n):"last_".concat(e,"_").concat(n)},getThisPeriod:function(e){return"this_".concat(e)},formatDate:Ye,migrateLegacyPeriod:Oe,migrateLegacyCompareMode:Ae,toLegacyPeriod:ze,toLegacyCompareMode:function(e){switch(e){case"auto":case"12_months_ago":return e;default:return ze(e)}},retrievePeriod:Ee,retrievePeriodParams:Ge,retrieveComparePeriod:function(e,t){return ke(Oe(e),Ae(t))},calculateAutoCompare:function(e,t){var r=Ne(Oe(e),t);return{label:r.label,period:r.range}}}});
