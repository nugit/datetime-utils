!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["nugit-datetime-utils"]=t()}(this,function(){"use strict";var g=function(e){return e instanceof Date},v=36e5,h=6e4,m=/[T ]/,y=/:/,D=/^(\d{2})$/,p=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],M=/^(\d{4})/,w=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],Y=/^-(\d{2})$/,T=/^-?(\d{3})$/,_=/^-?(\d{2})-?(\d{2})$/,b=/^-?W(\d{2})$/,S=/^-?W(\d{2})-?(\d{1})$/,F=/^(\d{2}([.,]\d*)?)$/,x=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,H=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,$=/([Z+-].*)$/,P=/^(Z)$/,I=/^([+-])(\d{2})$/,N=/^([+-])(\d{2}):?(\d{2})$/;function k(e,t,r){t=t||0,r=r||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var a=7*t+r+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+a),n}var c=function(e,t){if(g(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var r=(t||{}).additionalDigits;r=null==r?2:Number(r);var n=function(e){var t,r={},n=e.split(m);if(t=y.test(n[0])?(r.date=null,n[0]):(r.date=n[0],n[1])){var a=$.exec(t);a?(r.time=t.replace(a[1],""),r.timezone=a[1]):r.time=t}return r}(e),a=function(e,t){var r,n=p[t],a=w[t];if(r=M.exec(e)||a.exec(e)){var u=r[1];return{year:parseInt(u,10),restDateString:e.slice(u.length)}}if(r=D.exec(e)||n.exec(e)){var o=r[1];return{year:100*parseInt(o,10),restDateString:e.slice(o.length)}}return{year:null}}(n.date,r),u=a.year,o=function(e,t){if(null===t)return null;var r,n,a,u;if(0===e.length)return(n=new Date(0)).setUTCFullYear(t),n;if(r=Y.exec(e))return n=new Date(0),a=parseInt(r[1],10)-1,n.setUTCFullYear(t,a),n;if(r=T.exec(e)){n=new Date(0);var o=parseInt(r[1],10);return n.setUTCFullYear(t,0,o),n}if(r=_.exec(e)){n=new Date(0),a=parseInt(r[1],10)-1;var i=parseInt(r[2],10);return n.setUTCFullYear(t,a,i),n}if(r=b.exec(e))return u=parseInt(r[1],10)-1,k(t,u);if(r=S.exec(e)){u=parseInt(r[1],10)-1;var c=parseInt(r[2],10)-1;return k(t,u,c)}return null}(a.restDateString,u);if(o){var i,c=o.getTime(),s=0;return n.time&&(s=function(e){var t,r,n;if(t=F.exec(e))return(r=parseFloat(t[1].replace(",",".")))%24*v;if(t=x.exec(e))return r=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")),r%24*v+n*h;if(t=H.exec(e)){r=parseInt(t[1],10),n=parseInt(t[2],10);var a=parseFloat(t[3].replace(",","."));return r%24*v+n*h+1e3*a}return null}(n.time)),i=n.timezone?(f=n.timezone,(l=P.exec(f))?0:(l=I.exec(f))?(d=60*parseInt(l[2],10),"+"===l[1]?-d:d):(l=N.exec(f))?(d=60*parseInt(l[2],10)+parseInt(l[3],10),"+"===l[1]?-d:d):0):(i=new Date(c+s).getTimezoneOffset(),new Date(c+s+i*h).getTimezoneOffset()),new Date(c+s+i*h)}var f,l,d;return new Date(e)};var o=function(e){var t=c(e);return t.setHours(0,0,0,0),t};var d=function(e,t){var r=o(e),n=o(t);return r.getTime()===n.getTime()};var C=function(e){return c(e).getDate()};var r=function(e){var t=c(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r};var i=function(e,t){var r=o(e),n=o(t),a=r.getTime()-6e4*r.getTimezoneOffset(),u=n.getTime()-6e4*n.getTimezoneOffset();return Math.round((a-u)/864e5)};var O=function(e){var t=c(e);return i(t,r(t))+1};var n=function(e,t){var r=c(e),n=Number(t);return r.setDate(r.getDate()+n),r};var z=function(e,t){var r=Number(t);return n(e,-r)};var A=function(e){var t=c(e),r=t.getFullYear(),n=t.getMonth(),a=new Date(0);return a.setFullYear(r,n+1,0),a.setHours(0,0,0,0),a.getDate()};var a=function(e,t){var r=c(e),n=Number(t),a=r.getMonth()+n,u=new Date(0);u.setFullYear(r.getFullYear(),a,1),u.setHours(0,0,0,0);var o=A(u);return r.setMonth(a,Math.min(o,r.getDate())),r};var u=function(e,t){var r=Number(t);return a(e,12*r)};var s=function(e,t){var r=Number(t);return u(e,-r)};var t=function(e){var t=c(e).getFullYear();return t%400==0||t%4==0&&t%100!=0};var W=function(e){return t(e)?366:365};var E=function(e){return 1===c(e).getDay()};var G=function(e){return 0===c(e).getDay()};function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=[],n=!0,a=!1,u=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,u=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw u}}return r}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var l=function(e,t){var r=t&&Number(t.weekStartsOn)||0,n=c(e),a=n.getDay(),u=(a<r?7:0)+a-r;return n.setDate(n.getDate()-u),n.setHours(0,0,0,0),n};var q=function(e){return l(e,{weekStartsOn:1})};var U=function(e){var t=c(e),r=t.getFullYear(),n=new Date(0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);var a=q(n),u=new Date(0);u.setFullYear(r,0,4),u.setHours(0,0,0,0);var o=q(u);return t.getTime()>=a.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1};var X=function(e){var t=U(e),r=new Date(0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),q(r)};var Z=function(e){var t=c(e),r=q(t).getTime()-X(t).getTime();return Math.round(r/6048e5)+1};var R=function(e){if(g(e))return!isNaN(e);throw new TypeError(toString.call(e)+" is not an instance of Date")};var J=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];var L=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);var n=J.concat(t).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+n.join("|")+"|.)","g")};var e=function(){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Su","Mo","Tu","We","Th","Fr","Sa"],a=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],o=["AM","PM"],i=["am","pm"],c=["a.m.","p.m."],e={MMM:function(e){return t[e.getMonth()]},MMMM:function(e){return r[e.getMonth()]},dd:function(e){return n[e.getDay()]},ddd:function(e){return a[e.getDay()]},dddd:function(e){return u[e.getDay()]},A:function(e){return 1<=e.getHours()/12?o[1]:o[0]},a:function(e){return 1<=e.getHours()/12?i[1]:i[0]},aa:function(e){return 1<=e.getHours()/12?c[1]:c[0]}};return["M","D","DDD","d","Q","W"].forEach(function(r){e[r+"o"]=function(e,t){return function(e){var t=e%100;if(20<t||t<10)switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"}(t[r](e))}}),{formatters:e,formattingTokensRegExp:L(e)}},Q={distanceInWords:function(){var a={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(e,t,r){var n;return r=r||{},n="string"==typeof a[e]?a[e]:1===t?a[e].one:a[e].other.replace("{{count}}",t),r.addSuffix?0<r.comparison?"in "+n:n+" ago":n}}}(),format:e()};var j={M:function(e){return e.getMonth()+1},MM:function(e){return K(e.getMonth()+1,2)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},D:function(e){return e.getDate()},DD:function(e){return K(e.getDate(),2)},DDD:function(e){return O(e)},DDDD:function(e){return K(O(e),3)},d:function(e){return e.getDay()},E:function(e){return e.getDay()||7},W:function(e){return Z(e)},WW:function(e){return K(Z(e),2)},YY:function(e){return K(e.getFullYear(),4).substr(2)},YYYY:function(e){return K(e.getFullYear(),4)},GG:function(e){return String(U(e)).substr(2)},GGGG:function(e){return U(e)},H:function(e){return e.getHours()},HH:function(e){return K(e.getHours(),2)},h:function(e){var t=e.getHours();return 0===t?12:12<t?t%12:t},hh:function(e){return K(j.h(e),2)},m:function(e){return e.getMinutes()},mm:function(e){return K(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return K(e.getSeconds(),2)},S:function(e){return Math.floor(e.getMilliseconds()/100)},SS:function(e){return K(Math.floor(e.getMilliseconds()/10),2)},SSS:function(e){return K(e.getMilliseconds(),3)},Z:function(e){return B(e.getTimezoneOffset(),":")},ZZ:function(e){return B(e.getTimezoneOffset())},X:function(e){return Math.floor(e.getTime()/1e3)},x:function(e){return e.getTime()}};function B(e,t){t=t||"";var r=0<e?"-":"+",n=Math.abs(e),a=n%60;return r+K(Math.floor(n/60),2)+t+K(a,2)}function K(e,t){for(var r=Math.abs(e).toString();r.length<t;)r="0"+r;return r}var V=function(e,t,r){var n=t?String(t):"YYYY-MM-DDTHH:mm:ss.SSSZ",a=(r||{}).locale,u=Q.format.formatters,o=Q.format.formattingTokensRegExp;a&&a.format&&a.format.formatters&&(u=a.format.formatters,a.format.formattingTokensRegExp&&(o=a.format.formattingTokensRegExp));var i=c(e);return R(i)?function(e,t,r){var n,a,u,o=e.match(r),i=o.length;for(n=0;n<i;n++)a=t[o[n]]||j[o[n]],o[n]=a||((u=o[n]).match(/\[[\s\S]/)?u.replace(/^\[|]$/g,""):u.replace(/\\/g,""));return function(e){for(var t="",r=0;r<i;r++)o[r]instanceof Function?t+=o[r](e,j):t+=o[r];return t}}(n,u,o)(i):"Invalid Date"};var ee=function(e,t){var r=Number(t);return a(e,-r)};var te=function(e,t){var r=Number(t);return n(e,7*r)};var re=function(e,t){var r=Number(t);return te(e,-r)};var ne=function(e,t){var r=Number(t);return a(e,3*r)};var ae=function(e,t){var r=Number(t);return ne(e,-r)};var ue=function(e){var t=c(e);return t.setDate(1),t.setHours(0,0,0,0),t};var oe=function(e){var t=c(e),r=t.getMonth(),n=r-r%3;return t.setMonth(n,1),t.setHours(0,0,0,0),t};var ie=function(e){var t=c(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t};var ce=function(e,t){var r=t&&Number(t.weekStartsOn)||0,n=c(e),a=n.getDay(),u=6+(a<r?-7:0)-(a-r);return n.setDate(n.getDate()+u),n.setHours(23,59,59,999),n};var se=function(e){return ce(e,{weekStartsOn:1})};var fe=function(e){var t=c(e),r=t.getMonth(),n=r-r%3+3;return t.setMonth(n,0),t.setHours(23,59,59,999),t};var le=function(e){var t=c(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(23,59,59,999),t};var de=function(e,t){var r=c(e).getTime(),n=c(t).getTime();return r<n?-1:n<r?1:0};var ge=function(e,t){var r=c(e),n=c(t),a=de(r,n),u=Math.abs(i(r,n));return r.setDate(r.getDate()-a*u),a*(u-(de(r,n)===-a))};var ve=function(e,t){var r=ge(e,t)/7;return 0<r?Math.floor(r):Math.ceil(r)};var he=function(e,t){var r=c(e),n=c(t);return 12*(r.getFullYear()-n.getFullYear())+(r.getMonth()-n.getMonth())};var me=function(e,t){var r=c(e),n=c(t),a=de(r,n),u=Math.abs(he(r,n));return r.setMonth(r.getMonth()-a*u),a*(u-(de(r,n)===-a))};var ye=function(e,t){var r=me(e,t)/3;return 0<r?Math.floor(r):Math.ceil(r)};var De=function(e,t){var r=c(e),n=c(t);return r.getFullYear()-n.getFullYear()};var pe=function(e,t){var r=c(e),n=c(t),a=de(r,n),u=Math.abs(De(r,n));return r.setFullYear(r.getFullYear()-a*u),a*(u-(de(r,n)===-a))},Me=function(e){return V(e,"YYYY-MM-DD")},we=function(e){return"year"===e?s:"quarter"===e?ae:"month"===e?ee:"week"===e?re:z},Ye=function(e){return"year"===e?r:"quarter"===e?oe:"month"===e?ue:"week"===e?q:function(e){return e}},Te=function(e){return"year"===e?le:"quarter"===e?fe:"month"===e?ie:"week"===e?se:function(e){return e}},_e=function(e){return"number"!=typeof e?3600*(t=f(e.split(":"),2),r=t[0],n=t[1],a="+"===r[0],u=parseInt(r.slice(1),10)+parseInt(n,10)/60,a?u:-u)*1e3:15<Math.abs(e)?1e3*e:3600*e*1e3;var t,r,n,a,u},be=function(e,t){if(!e)return t;var r=t instanceof Date?t:new Date(t),n=_e(e)+60*(new Date).getTimezoneOffset()*1e3;return new Date(r.getTime()+n)},Se=function(e,t){return{start:Me(e),end:Me(t)}},Fe=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Date,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=z(t,1),a=Ye(e),u=we(e);return Se(a(u(n,r-1)),Me(n))},xe=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Date,r=z(t,1);return Se(e,r)},He=function(e){var t=e.match(/^last_(day|week|month|quarter|year)(_including_current)?$/);if(t)return{type:"last",num:1,unit:t[1],including_current:"_including_current"===t[2],includingParam:"this"};if(t=e.match(/^last_(\d+)_(day|week|month|quarter|year)s?(_including_current)?$/))return{type:"last",num:Number(t[1]),unit:t[2],including_current:"_including_current"===t[3],includingParam:"day"===t[2]?"today":"this ".concat(t[2])};if(t=e.match(/^this_(day|week|month|quarter|year)$/))return{type:"this",unit:t[1]};if(t=e.match(/^(\d{4}-\d{2}-\d{2})_to_yesterday$/))return{type:"till_yesterday",start:t[1]};if(t=e.match(/^(\d{4}-\d{2}-\d{2})_to_(\d{4}-\d{2}-\d{2})$/))return{type:"custom",start:t[1],end:t[2]};switch(e){case"yesterday":return{type:"yesterday"};case"all_time":return{type:"all_time"};default:throw new Error("Unrecognized date range: ".concat(e))}},$e=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Date,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=be(r,t),a=He(e);switch(a.type){case"last":var u=a.unit,o=a.num;return a.including_current?Fe(u,n,o):function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Date,n=Ye(t),a=Te(t),u=we(t);return Se(n(u(r,e)),a(u(r,1)))}(o,u,n);case"this":return Fe(a.unit,n);case"till_yesterday":return xe(be(r,a.start),n);case"yesterday":return Fe("day",n);case"all_time":return xe(new Date("2015-01-01"),n);case"custom":return Se(be(r,a.start),be(r,a.end));default:throw new Error("Unrecognized date range: ".concat(e))}},Pe=function(e){var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Date,n=$e(e,r),a=n.start,u=n.end,o=He(e);switch(o.type){case"last":var i=we(o.unit);return{label:"Previous ".concat(o.num," ").concat(o.unit),range:Se(i(a,o.num),z(a,1))};case"this":var c=we(o.unit);return{label:"Previous ".concat(o.unit),range:Se(c(a,1),z(a,1))};case"yesterday":return{label:"Previous Day",range:Se(z(a,1),z(a,1))};default:var s=function(e,t){if(1===O(e)&&O(t)===W(t))return"year";var r=Ye("quarter"),n=Te("quarter");return d(r(e),e)&&d(n(t),t)?"quarter":1===C(e)&&C(t)===A(t)?"month":E(e)&&G(t)?"week":"day"}(a,u),f=we(s)(a,("year"===(t=s)?pe:"quarter"===t?ye:"month"===t?me:"week"===t?ve:ge)(u,a)+1),l=z(a,1);return{label:"Previous Period",range:Se(f,l)}}},Ie=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"auto";switch(t){case"auto":return Pe(e).range;case"12_months_ago":var r=$e(e),n=r.start,a=r.end;return Se(s(n,1),s(a,1));default:return $e(t)}},Ne=function(e,t){return"".concat(Me(e),"_to_").concat(Me(t))},ke=function(e){if("string"!=typeof e)return Ne(e.start,e.end);var t=e.match(/^last(\d+)(day|week|month|quarter|year)s?$/);if(t)return"last_".concat(t[1],"_").concat(t[2]);var r=e.match(/^(last_(\d+)_days?)_including_current$/);if(r)return r[1];switch(e){case"today":return"yesterday";case"year_to_date":return"this_year";default:return e}},Ce=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"auto";switch(e){case"auto":case"12_months_ago":return e;default:return ke(e)}},Oe=function(a){return function(e){for(var t=arguments.length,r=new Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return a.apply(void 0,[ke(e)].concat(r))}},ze=function(e){return"custom"===He(e).type?$e(e):e},Ae=Oe($e),We=Oe(He);return{getRange:$e,getPeriodParams:He,getCompareRange:Ie,getAutoCompareRangeAndLabel:Pe,getTillYesterdayPeriod:function(e){return"".concat(Me(e),"_to_yesterday")},getCustomPeriod:Ne,getLastPeriod:function(e,t,r){var n="".concat(t).concat(r?"_including_current":"");return 1===e?"last_".concat(n):"last_".concat(e,"_").concat(n)},getThisPeriod:function(e){return"this_".concat(e)},formatDate:Me,migrateLegacyPeriod:ke,migrateLegacyCompareMode:Ce,toLegacyPeriod:ze,toLegacyCompareMode:function(e){switch(e){case"auto":case"12_months_ago":return e;default:return ze(e)}},retrievePeriod:Ae,retrievePeriodParams:We,retrieveComparePeriod:function(e,t){return Ie(ke(e),Ce(t))},calculateAutoCompare:function(e,t){var r=Pe(ke(e),t);return{label:r.label,period:r.range}}}});
