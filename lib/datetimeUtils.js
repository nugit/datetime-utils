"use strict";function isDate(e){return e instanceof Date}Object.defineProperty(exports,"__esModule",{value:!0});var is_date=isDate,MILLISECONDS_IN_HOUR=36e5,MILLISECONDS_IN_MINUTE=6e4,DEFAULT_ADDITIONAL_DIGITS=2,parseTokenDateTimeDelimeter=/[T ]/,parseTokenPlainTime=/:/,parseTokenYY=/^(\d{2})$/,parseTokensYYY=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],parseTokenYYYY=/^(\d{4})/,parseTokensYYYYY=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],parseTokenMM=/^-(\d{2})$/,parseTokenDDD=/^-?(\d{3})$/,parseTokenMMDD=/^-?(\d{2})-?(\d{2})$/,parseTokenWww=/^-?W(\d{2})$/,parseTokenWwwD=/^-?W(\d{2})-?(\d{1})$/,parseTokenHH=/^(\d{2}([.,]\d*)?)$/,parseTokenHHMM=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,parseTokenHHMMSS=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,parseTokenTimezone=/([Z+-].*)$/,parseTokenTimezoneZ=/^(Z)$/,parseTokenTimezoneHH=/^([+-])(\d{2})$/,parseTokenTimezoneHHMM=/^([+-])(\d{2}):?(\d{2})$/;function parse(e,t){if(is_date(e))return new Date(e.getTime());if("string"!=typeof e)return new Date(e);var r=(t||{}).additionalDigits;r=null==r?DEFAULT_ADDITIONAL_DIGITS:Number(r);var a=splitDateString(e),n=parseYear(a.date,r),o=n.year,s=parseDate(n.restDateString,o);if(s){var u,i=s.getTime(),d=0;return a.time&&(d=parseTime(a.time)),u=a.timezone?parseTimezone(a.timezone):(u=new Date(i+d).getTimezoneOffset(),new Date(i+d+u*MILLISECONDS_IN_MINUTE).getTimezoneOffset()),new Date(i+d+u*MILLISECONDS_IN_MINUTE)}return new Date(e)}function splitDateString(e){var t,r={},a=e.split(parseTokenDateTimeDelimeter);if(t=parseTokenPlainTime.test(a[0])?(r.date=null,a[0]):(r.date=a[0],a[1])){var n=parseTokenTimezone.exec(t);n?(r.time=t.replace(n[1],""),r.timezone=n[1]):r.time=t}return r}function parseYear(e,t){var r,a=parseTokensYYY[t],n=parseTokensYYYYY[t];if(r=parseTokenYYYY.exec(e)||n.exec(e)){var o=r[1];return{year:parseInt(o,10),restDateString:e.slice(o.length)}}if(r=parseTokenYY.exec(e)||a.exec(e)){var s=r[1];return{year:100*parseInt(s,10),restDateString:e.slice(s.length)}}return{year:null}}function parseDate(e,t){if(null===t)return null;var r,a,n;if(0===e.length)return(a=new Date(0)).setUTCFullYear(t),a;if(r=parseTokenMM.exec(e))return a=new Date(0),n=parseInt(r[1],10)-1,a.setUTCFullYear(t,n),a;if(r=parseTokenDDD.exec(e)){a=new Date(0);var o=parseInt(r[1],10);return a.setUTCFullYear(t,0,o),a}if(r=parseTokenMMDD.exec(e)){a=new Date(0),n=parseInt(r[1],10)-1;var s=parseInt(r[2],10);return a.setUTCFullYear(t,n,s),a}return(r=parseTokenWww.exec(e))?dayOfISOYear(t,parseInt(r[1],10)-1):(r=parseTokenWwwD.exec(e))?dayOfISOYear(t,parseInt(r[1],10)-1,parseInt(r[2],10)-1):null}function parseTime(e){var t,r,a;if(t=parseTokenHH.exec(e))return(r=parseFloat(t[1].replace(",",".")))%24*MILLISECONDS_IN_HOUR;if(t=parseTokenHHMM.exec(e))return r=parseInt(t[1],10),a=parseFloat(t[2].replace(",",".")),r%24*MILLISECONDS_IN_HOUR+a*MILLISECONDS_IN_MINUTE;if(t=parseTokenHHMMSS.exec(e)){r=parseInt(t[1],10),a=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return r%24*MILLISECONDS_IN_HOUR+a*MILLISECONDS_IN_MINUTE+1e3*n}return null}function parseTimezone(e){var t,r;return(t=parseTokenTimezoneZ.exec(e))?0:(t=parseTokenTimezoneHH.exec(e))?(r=60*parseInt(t[2],10),"+"===t[1]?-r:r):(t=parseTokenTimezoneHHMM.exec(e))?(r=60*parseInt(t[2],10)+parseInt(t[3],10),"+"===t[1]?-r:r):0}function dayOfISOYear(e,t,r){t=t||0,r=r||0;var a=new Date(0);a.setUTCFullYear(e,0,4);var n=7*t+r+1-(a.getUTCDay()||7);return a.setUTCDate(a.getUTCDate()+n),a}var parse_1=parse;function addDays(e,t){var r=parse_1(e),a=Number(t);return r.setDate(r.getDate()+a),r}var add_days=addDays;function getDaysInMonth(e){var t=parse_1(e),r=t.getFullYear(),a=t.getMonth(),n=new Date(0);return n.setFullYear(r,a+1,0),n.setHours(0,0,0,0),n.getDate()}var get_days_in_month=getDaysInMonth;function addMonths(e,t){var r=parse_1(e),a=Number(t),n=r.getMonth()+a,o=new Date(0);o.setFullYear(r.getFullYear(),n,1),o.setHours(0,0,0,0);var s=get_days_in_month(o);return r.setMonth(n,Math.min(s,r.getDate())),r}var add_months=addMonths;function endOfYear(e){var t=parse_1(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(23,59,59,999),t}var end_of_year=endOfYear;function startOfDay(e){var t=parse_1(e);return t.setHours(0,0,0,0),t}var start_of_day=startOfDay,MILLISECONDS_IN_MINUTE$1=6e4,MILLISECONDS_IN_DAY=864e5;function differenceInCalendarDays(e,t){var r=start_of_day(e),a=start_of_day(t),n=r.getTime()-r.getTimezoneOffset()*MILLISECONDS_IN_MINUTE$1,o=a.getTime()-a.getTimezoneOffset()*MILLISECONDS_IN_MINUTE$1;return Math.round((n-o)/MILLISECONDS_IN_DAY)}var difference_in_calendar_days=differenceInCalendarDays;function compareAsc(e,t){var r=parse_1(e).getTime(),a=parse_1(t).getTime();return r<a?-1:a<r?1:0}var compare_asc=compareAsc;function differenceInDays(e,t){var r=parse_1(e),a=parse_1(t),n=compare_asc(r,a),o=Math.abs(difference_in_calendar_days(r,a));return r.setDate(r.getDate()-n*o),n*(o-(compare_asc(r,a)===-n))}var difference_in_days=differenceInDays;function getDate(e){return parse_1(e).getDate()}var get_date=getDate;function getMonth(e){return parse_1(e).getMonth()}var get_month=getMonth;function getYear(e){return parse_1(e).getFullYear()}var get_year=getYear;function lastDayOfYear(e){var t=parse_1(e),r=t.getFullYear();return t.setFullYear(r+1,0,0),t.setHours(0,0,0,0),t}var last_day_of_year=lastDayOfYear;function setDate(e,t){var r=parse_1(e),a=Number(t);return r.setDate(a),r}var set_date=setDate;function setDay(e,t,r){var a=r&&Number(r.weekStartsOn)||0,n=parse_1(e),o=Number(t),s=n.getDay();return add_days(n,((o%7+7)%7<a?7:0)+o-s)}var set_day=setDay;function setDayOfYear(e,t){var r=parse_1(e),a=Number(t);return r.setMonth(0),r.setDate(a),r}var set_day_of_year=setDayOfYear;function setMonth(e,t){var r=parse_1(e),a=Number(t),n=r.getFullYear(),o=r.getDate(),s=new Date(0);s.setFullYear(n,a,15),s.setHours(0,0,0,0);var u=get_days_in_month(s);return r.setMonth(a,Math.min(o,u)),r}var set_month=setMonth;function subDays(e,t){var r=Number(t);return add_days(e,-r)}var sub_days=subDays;function subMonths(e,t){var r=Number(t);return add_months(e,-r)}var sub_months=subMonths;function addWeeks(e,t){var r=Number(t);return add_days(e,7*r)}var add_weeks=addWeeks;function subWeeks(e,t){var r=Number(t);return add_weeks(e,-r)}var sub_weeks=subWeeks;function addYears(e,t){var r=Number(t);return add_months(e,12*r)}var add_years=addYears;function subYears(e,t){var r=Number(t);return add_years(e,-r)}var sub_years=subYears;function startOfYear(e){var t=parse_1(e),r=new Date(0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}var start_of_year=startOfYear;function getDayOfYear(e){var t=parse_1(e);return difference_in_calendar_days(t,start_of_year(t))+1}var get_day_of_year=getDayOfYear;function startOfWeek(e,t){var r=t&&Number(t.weekStartsOn)||0,a=parse_1(e),n=a.getDay(),o=(n<r?7:0)+n-r;return a.setDate(a.getDate()-o),a.setHours(0,0,0,0),a}var start_of_week=startOfWeek;function startOfISOWeek(e){return start_of_week(e,{weekStartsOn:1})}var start_of_iso_week=startOfISOWeek;function getISOYear(e){var t=parse_1(e),r=t.getFullYear(),a=new Date(0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);var n=start_of_iso_week(a),o=new Date(0);o.setFullYear(r,0,4),o.setHours(0,0,0,0);var s=start_of_iso_week(o);return t.getTime()>=n.getTime()?r+1:t.getTime()>=s.getTime()?r:r-1}var get_iso_year=getISOYear;function startOfISOYear(e){var t=get_iso_year(e),r=new Date(0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),start_of_iso_week(r)}var start_of_iso_year=startOfISOYear,MILLISECONDS_IN_WEEK=6048e5;function getISOWeek(e){var t=parse_1(e),r=start_of_iso_week(t).getTime()-start_of_iso_year(t).getTime();return Math.round(r/MILLISECONDS_IN_WEEK)+1}var get_iso_week=getISOWeek;function isValid(e){if(is_date(e))return!isNaN(e);throw new TypeError(toString.call(e)+" is not an instance of Date")}var is_valid=isValid;function buildDistanceInWordsLocale(){var n={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};return{localize:function(e,t,r){var a;return r=r||{},a="string"==typeof n[e]?n[e]:1===t?n[e].one:n[e].other.replace("{{count}}",t),r.addSuffix?0<r.comparison?"in "+a:a+" ago":a}}}var build_distance_in_words_locale=buildDistanceInWordsLocale,commonFormatterKeys=["M","MM","Q","D","DD","DDD","DDDD","d","E","W","WW","YY","YYYY","GG","GGGG","H","HH","h","hh","m","mm","s","ss","S","SS","SSS","Z","ZZ","X","x"];function buildFormattingTokensRegExp(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);var a=commonFormatterKeys.concat(t).sort().reverse();return new RegExp("(\\[[^\\[]*\\])|(\\\\)?("+a.join("|")+"|.)","g")}var build_formatting_tokens_reg_exp=buildFormattingTokensRegExp;function buildFormatLocale(){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["Su","Mo","Tu","We","Th","Fr","Sa"],n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],s=["AM","PM"],u=["am","pm"],i=["a.m.","p.m."],e={MMM:function(e){return t[e.getMonth()]},MMMM:function(e){return r[e.getMonth()]},dd:function(e){return a[e.getDay()]},ddd:function(e){return n[e.getDay()]},dddd:function(e){return o[e.getDay()]},A:function(e){return 1<=e.getHours()/12?s[1]:s[0]},a:function(e){return 1<=e.getHours()/12?u[1]:u[0]},aa:function(e){return 1<=e.getHours()/12?i[1]:i[0]}};return["M","D","DDD","d","Q","W"].forEach(function(r){e[r+"o"]=function(e,t){return ordinal(t[r](e))}}),{formatters:e,formattingTokensRegExp:build_formatting_tokens_reg_exp(e)}}function ordinal(e){var t=e%100;if(20<t||t<10)switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"}var build_format_locale=buildFormatLocale,en={distanceInWords:build_distance_in_words_locale(),format:build_format_locale()};function format(e,t,r){var a=t?String(t):"YYYY-MM-DDTHH:mm:ss.SSSZ",n=(r||{}).locale,o=en.format.formatters,s=en.format.formattingTokensRegExp;n&&n.format&&n.format.formatters&&(o=n.format.formatters,n.format.formattingTokensRegExp&&(s=n.format.formattingTokensRegExp));var u=parse_1(e);return is_valid(u)?buildFormatFn(a,o,s)(u):"Invalid Date"}var formatters={M:function(e){return e.getMonth()+1},MM:function(e){return addLeadingZeros(e.getMonth()+1,2)},Q:function(e){return Math.ceil((e.getMonth()+1)/3)},D:function(e){return e.getDate()},DD:function(e){return addLeadingZeros(e.getDate(),2)},DDD:function(e){return get_day_of_year(e)},DDDD:function(e){return addLeadingZeros(get_day_of_year(e),3)},d:function(e){return e.getDay()},E:function(e){return e.getDay()||7},W:function(e){return get_iso_week(e)},WW:function(e){return addLeadingZeros(get_iso_week(e),2)},YY:function(e){return addLeadingZeros(e.getFullYear(),4).substr(2)},YYYY:function(e){return addLeadingZeros(e.getFullYear(),4)},GG:function(e){return String(get_iso_year(e)).substr(2)},GGGG:function(e){return get_iso_year(e)},H:function(e){return e.getHours()},HH:function(e){return addLeadingZeros(e.getHours(),2)},h:function(e){var t=e.getHours();return 0===t?12:12<t?t%12:t},hh:function(e){return addLeadingZeros(formatters.h(e),2)},m:function(e){return e.getMinutes()},mm:function(e){return addLeadingZeros(e.getMinutes(),2)},s:function(e){return e.getSeconds()},ss:function(e){return addLeadingZeros(e.getSeconds(),2)},S:function(e){return Math.floor(e.getMilliseconds()/100)},SS:function(e){return addLeadingZeros(Math.floor(e.getMilliseconds()/10),2)},SSS:function(e){return addLeadingZeros(e.getMilliseconds(),3)},Z:function(e){return formatTimezone(e.getTimezoneOffset(),":")},ZZ:function(e){return formatTimezone(e.getTimezoneOffset())},X:function(e){return Math.floor(e.getTime()/1e3)},x:function(e){return e.getTime()}};function buildFormatFn(e,t,r){var a,n,o=e.match(r),s=o.length;for(a=0;a<s;a++)n=t[o[a]]||formatters[o[a]],o[a]=n||removeFormattingTokens(o[a]);return function(e){for(var t="",r=0;r<s;r++)o[r]instanceof Function?t+=o[r](e,formatters):t+=o[r];return t}}function removeFormattingTokens(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|]$/g,""):e.replace(/\\/g,"")}function formatTimezone(e,t){t=t||"";var r=0<e?"-":"+",a=Math.abs(e),n=a%60;return r+addLeadingZeros(Math.floor(a/60),2)+t+addLeadingZeros(n,2)}function addLeadingZeros(e,t){for(var r=Math.abs(e).toString();r.length<t;)r="0"+r;return r}var format_1=format,formatDate=function(e){return format_1(e,"YYYY-MM-DD")},getSubtractionFn=function(e){return"year"===e?sub_years:"month"===e?sub_months:"quarter"===e?function(e,t){return sub_months(e,3*t)}:"week"===e?sub_weeks:sub_days},applyOffset=function(e,t){if(!e)return t;var r=new Date(t),a=60*e+r.getTimezoneOffset();return new Date(r.getTime()+60*a*1e3).toString()};function retrievePredefindedDateRange(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date();if("today"===e){var r=formatDate(t);return{start:r,end:r}}if("yesterday"===e){var a=formatDate(sub_days(t,1));return{start:a,end:a}}if("year_to_date"===e)return{start:formatDate(set_day_of_year(t,1)),end:formatDate(t)};if("all_time"===e)return{start:formatDate(sub_years(t,3)),end:formatDate(t)};throw new Error("Unrecognized date range: ".concat(e))}function retrieveLastRelativePeriod(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Date();return"year"===t?{start:formatDate(set_day_of_year(sub_years(r,e),1)),end:formatDate(set_date(set_month(sub_years(r,1),11),31))}:"quarter"===t?{start:formatDate(set_date(sub_months(r,3*e+get_month(r)%3),1)),end:formatDate(set_date(add_months(sub_months(r,3*e),3-get_month(r)%3),0))}:"month"===t?{start:formatDate(set_date(sub_months(r,e),1)),end:formatDate(set_date(r,0))}:"week"===t?{start:formatDate(set_day(sub_weeks(r,e),1)),end:formatDate(set_day(sub_weeks(r,1),7))}:{start:formatDate(sub_days(r,e)),end:formatDate(sub_days(r,1))}}function retrieveThisRelativePeriod(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date();if("year"===e)return{start:formatDate(set_day_of_year(t,1)),end:formatDate(last_day_of_year(t))};if("quarter"===e)return{start:formatDate(set_date(sub_months(t,get_month(t)%3),1)),end:formatDate(set_date(add_months(t,3-get_month(t)%3),0))};if("month"===e)return{start:formatDate(set_date(t,1)),end:formatDate(t)};if("week"===e)return{start:formatDate(set_day(t,1)),end:formatDate(set_day(t,7))};var r=formatDate(t);return{start:r,end:r}}function retrievePeriodParams(e){if("string"!=typeof e)return e;var t=e.match(/^last(\d+)(day|week|month|quarter|year)s?$/);return t?{type:"last",num:Number(t[1]),unit:t[2]}:(t=e.match(/^last_(day|week|month|quarter|year)$/))?{type:"last",num:1,unit:t[1]}:(t=e.match(/^last_(\d+)_(day|week|month|quarter|year)s?(_including_current)?$/))?{type:"last",num:Number(t[1]),unit:t[2],newFormat:!0,including_current:"_including_current"===t[3],includeingParam:"day"===t[2]?"today":"this ".concat(t[2])}:(t=e.match(/^this_(day|week|month|quarter|year)$/))?{type:"this",unit:t[1]}:(t=e.match(/^(\d{4}-\d{2}-\d{2})_to_yesterday$/))?{type:"till_tomorrow",start:t[1]}:"last"===e?{type:"last",num:void 0,unit:void 0}:null}function retrievePeriod(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date(),r=2<arguments.length?arguments[2]:void 0;if("string"!=typeof e)return e;var a=applyOffset(r,t),n=retrievePeriodParams(e);return n&&"last"===n.type?n.including_current?1===n.num?retrieveThisRelativePeriod(n.unit,a):{start:retrieveLastRelativePeriod(n.num-1,n.unit,a).start,end:retrieveThisRelativePeriod(n.unit,a).end}:retrieveLastRelativePeriod(n.num,n.unit,a):n&&"this"===n.type?retrieveThisRelativePeriod(n.unit,a):n&&"till_tomorrow"===n.type?{start:n.start,end:formatDate(sub_days(a,1))}:retrievePredefindedDateRange(e,a)}function calculateAutoCompare(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Date(),r={period:{}},a=retrievePeriod(e,t),n=retrievePeriodParams(e);if(n&&"this"===n.type){var o=getSubtractionFn(n.unit);return{label:"Previous ".concat(n.unit),period:{start:formatDate(o(a.start,1)),end:formatDate(sub_days(a.start,1))}}}if(n&&"last"===n.type){var s=getSubtractionFn(n.unit);return{label:"Previous ".concat(n.num," ").concat(n.unit),period:{start:formatDate(s(a.start,n.num)),end:formatDate(sub_days(a.start,1))}}}if("year_to_date"===e)return{label:"Previous Year",period:{start:formatDate(set_day_of_year(sub_years(t,1),1)),end:formatDate(end_of_year(sub_years(t,1)))}};r.label="today"===e||"yesterday"===e?"Previous Day":"Previous Period";var u=a.start,i=a.end,d=difference_in_days(i,u)+1,f=sub_days(u,d),_=sub_days(u,1),m=add_days(i,1);if(1===get_date(u)&&1===get_date(m)){var c=12*(get_year(m)-get_year(u))+get_month(m)-get_month(u);f=sub_months(a.start,c)}return 1===get_month(u)&&1===get_date(u)&&1===get_month(m)&&1===get_date(m)&&(f=sub_years(u,get_year(m)-get_year(u))),r.period={start:formatDate(f),end:formatDate(_)},r}function retrieveComparePeriod(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"auto";if("auto"===t)return calculateAutoCompare(e).period;if("12_months_ago"!==t)return t;var r=retrievePeriod(e);return{start:formatDate(sub_years(r.start,1)),end:formatDate(sub_years(r.end,1))}}var getDateRange=retrievePeriod;exports.retrievePeriodParams=retrievePeriodParams,exports.retrievePeriod=retrievePeriod,exports.calculateAutoCompare=calculateAutoCompare,exports.retrieveComparePeriod=retrieveComparePeriod,exports.getDateRange=getDateRange;
